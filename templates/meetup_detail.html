{% extends 'base.html' %} {% block content %}

{% load crispy_forms_tags %}

<div class="container-fluid">
    <div class="row">

        <div class="text-center">

            <!-- Event Title -->
            <h2 class="mt-3">
                <strong>LingoMeets Meet-Up: <u>{{ event.destination }}</u>
                </strong>
            </h2>

            <h4 class="mt-3">
                <strong><u>Price:</u> {{ event.price }}.00â‚¬
                </strong>
            </h4>

            <!-- Event Image -->
            <div class="container col-md-8 mt-4">
                <img src="{{ event.image.url }}" class="img-fluid rounded-circle" alt="Event Image">
            </div>

            <!-- Event Description -->
            <div class="event-description">
                <p>{{ event.description }}</p>
            </div>

        </div>

    </div>
</div>

<hr class="break mt-3">

<section class="container-fluid mt-4">

    <!-- User Reviews -->
    <h3 class="text-center">
        <strong><u>Reviews:</u></strong>
    </h3>

    {% if messages %}
    {% for message in messages %}

    <!-- Review Pending Message -->
    <div class="text-center h4 mt-3">
        <p>
            <strong>{{ message }}</strong>
        </p>
    </div>

    {% endfor %}
    {% endif %}

    {% if reviews %}

    {% for review in reviews %}
    
    {% if review.event == event %}

    <div class="text-center mt-4 mb-4">

        <!-- User Name And Submit Date -->
        <p class="font-weight-bold">
            <u>@{{ review.user }}

                <span class=" text-muted font-weight-normal">
                    {{ review.created_at }}
                </span> wrote:

            </u>
        </p>

        <!-- User Review -->
        <div class="review-content">
            <p>
                {{ review.content | linebreaks }}
            </p>
        </div>

        <!-- User Rating -->
        <h6>
            <u>Score:</u>
        </h6>

        <p>
            {% for x in review.get_range %}
            <i class="fa-solid fa-star"></i>
            {% endfor %}
        </p>

    </div>

    {% if review.user == request.user %}

    <!-- Edit And Delete Buttons -->
    <div class="row mb-5">
        <div class="col text-end">
            <a class="btn btn-secondary" href="{% url 'edit_review' review.id %}">Edit</a>
        </div>
        <div class="col text-start">
            <form action="{% url 'delete_review' event.slug %}" method="post">
                {% csrf_token %}
                <button type="submit" name="event_id" value="{{ event.slug }}"
                    class="btn btn-danger btn-delete">Delete</button>
            </form>
        </div>
    </div>

    {% endif %}

    <hr class="break">

    {% endif %}

    {% endfor %}

    {% endif %}

    {% if user.is_authenticated %}

    <!-- Leave A Review Section -->

    <section class="review-box">

        <!-- Title -->
        <h3>
            <strong><u>Leave a review:</u></strong>
        </h3>

        <!-- User Username -->
        <h5>
            <strong><em>Posting as: @{{ user.username }}</em></strong>
        </h5>

        <!-- Crispy Form For Review -->
        <div class="form-group">
            <form method="post" class="form-group">
                <strong>{{ review_form | crispy }}</strong>
                {% csrf_token %}
                <button type="submit" class="btn btn-secondary mt-3 mb-4">Submit</button>
            </form>
        </div>

    </section>

    {% endif %}

</section>



{% endblock %}